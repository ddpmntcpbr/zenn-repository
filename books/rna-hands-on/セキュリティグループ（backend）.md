## この章でやること

backend用のセキュリティーグループを作成します。

## セキュリティグループとは？

VPC内に構築したアプリケーションやデータベースに対する、インバウンドルールとアウトバウンドルールを制御するものです。

「インバウンドルール」は、外部からの通信を受け入れる条件を定義したルール、「アウトバウンドルール」は、逆に外部へ通信を返す条件を定義したルールです。

前章でインターネットゲートウェイにルートテーブルを設定することで、インターネットからパブリックサブネットまでの間の道が開通できました。

しかし、**パブリックサブネット内に構築するアプリケーションの中までは、まだアクセスを許可していません**。家の前までは行けますが、家の中には入れないような状態です。

そこで、その家の扉に対して、「誰なら家の中に入れてよいのか」、「逆に、家の中の人をどこに対してなら出してもよいのか」というルールを設定してあげる必要があります。前者がインバウンドルール、後者がアウトバウンドルールであり、それをまとめて定義するのが**セキュリティーグループ**の役割です。

## backend用のセキュリティグループ

当ページでは、以下の二つのセキュリティグループを作成していきます。

1. ECS(backend)用セキュリティグループ
2. RDS用セキュリティグループ

「1. ECS(backend)用セキュリティグループ」は、パブリックサブネット内に構築する予定の、Railsアプリに関するセキュリティーグループです。VPC外の一般のインターネットユーザーとのやりとりを前提としているので、**あらゆる通信を許可するような設定**を行います。

「2. RDS用セキュリティグループ」は、プライペートサブネット内に構築する予定の、データベースに関するセキュリティーグループです。こちらは「1. ECS(backend)用セキュリティグループ」とは異なり、**パブリックサブネット内のRailsアプリとの通信のみを許可するような設定**を行います。

両者とも、後章でECS、RDSを構築するときに実際に使用していきます。

## 手順

VPCダッシュボードから「セキュリティグループ」にアクセスし、「セキュリティグループを作成」を押下します。

![](https://storage.googleapis.com/zenn-user-upload/2b965491c001-20230514.png)

### 1. ECS(backend)用セキュリティグループ

#### 基本的な詳細

|項目|値|
|---|---|
|セキュリティグループ名|zenn-clone-ecs-backend-security-group|
|説明|任意|
|VPC|zenn-clone-vpc|

![](https://storage.googleapis.com/zenn-user-upload/6e343f4eb6e7-20230514.png)

#### インバウンドルール

|項目|値|
|---|---|
|タイプ|HTTP|
|ソース|Anywhere-IPv4|

|項目|値|
|---|---|
|タイプ|HTTP|
|ソース|Anywhere-IPv6|

![](https://storage.googleapis.com/zenn-user-upload/7c502db85c28-20230514.png)

#### アウトバウンドルール

デフォルトのままでOKです（念のため以下の画像のようになっていることを確認してください）。

![](https://storage.googleapis.com/zenn-user-upload/8853e484f7b6-20230514.png)

↓

「セキュリティグループを作成」を押下し、セキュリティグループが正常に作成されたらOKです。

![](https://storage.googleapis.com/zenn-user-upload/51ffeabb2cbe-20230514.png)

↓

つづいて、RDS用のセキュリティグループを作成します。

### 2. RDS用セキュリティグループ

#### 基本的な詳細

|項目|値|
|---|---|
|セキュリティグループ名|zenn-clone-rds-security-group|
|説明|任意|
|VPC|zenn-clone-vpc|

![](https://storage.googleapis.com/zenn-user-upload/53be998890a6-20230514.png)

#### インバウンドルール

|項目|値|
|---|---|
|タイプ|MYSQL/Aurora|
|ソース|カスタム → 上で作成したセキュリティグループ（zenn-clone-ecs-backend-security-group）|

![](https://storage.googleapis.com/zenn-user-upload/be3cf638cc66-20230514.png)

#### アウトバウンドルール

デフォルトのままでOKです。

![](https://storage.googleapis.com/zenn-user-upload/8853e484f7b6-20230514.png)

↓

「セキュリティグループを作成」を押下し、セキュリティグループが正常に作成されたらOKです。

![](https://storage.googleapis.com/zenn-user-upload/532ad744b43c-20230514.png)

---
title: "【1. 環境構築編】Rails API とは？"
---

## この章は？

当教材で開発する**Rails APIモード**について解説をします。

## Rails の2つの開発モード

Railsアプリには、大きく分けて二つの開発モードがあります。

1. **通常のRailsアプリ**: MVCアーキテクチャーに則ったモード
2. **APIモードのRailsアプリ**: MVCアーキテクチャからV(View)をなくして、**JSON APIとしての役割に徹する**モード

## 1. 通常のRailsアプリ

Railsチュートリアルで開発したRailsアプリは、こちらに該当します。「2. APIモードのRailsアプリ」を説明するために、こちらの仕組みを一通り復習します。

そもそもRailsは、**MVCアーキテクチャー**という呼ばれる思想に基づいて設計がなされたアプリでした。MVCアーキテクチャーとは、**Model-View-Controller**の3つの要素でアプリケーションの根幹を設計するという設計思想です。

- **Model**: データベースとのやりとりを管理する要素
- **View**: ユーザーに表示される部分（HTML、CSS、JavaScript）を管理する要素
- **Controller**: Model と View の間の仲介役に位置し、両者をハンドリングする要素

以下の図は、「ユーザ一覧ページを取得する」過程を例にして、MVCアーキテクチャーの仕組みを示したものです。

![](https://storage.googleapis.com/zenn-user-upload/2c4540d45e07-20230825.png)

#### ① /users にリクエストする

開発環境であれば`http://localhost:3000/users`、本番環境であれば`https://www.example.com/users`などに対して、クライアント（ブラウザ）からリクエストを送信します。

#### ② UsersController#indexを呼び出す

クライアントからのリクエストは、まずルーティング(`config/route.rb`)に送達し、ルーティングに定義されたコントローラー(`UsersController`)のアクション(`index`アクション)を呼び出します。

#### ③ Userモデルを呼び出す

users レコードをDBから取得するために、まず UsersController#index から Userモデルを呼び出します。

#### ④ usersレコードを取得するクエリをDBに発行する

そしてUserモデルからDBに対して、users レコードを取得するSQLクエリを発行します。

#### ⑤ usersレコードをUserモデルに渡す

SQLクエリを受け取ったDBは、クエリにしたがって users レコードを取り出し、Userモデルに結果を返します。

#### ⑥ usersレコードをコントローラーに渡す

DBから users レコードを受け取った User モデルは、その内容をそのまま UsersController#index に渡します。

#### ⑦ users レコードをビューに渡す

モデルから users レコードを受け取ったアクションは、その内容を、自身のアクションに対応するビューファイル /users/index.html.erb に渡します。

#### ⑧ usereレコードの基づいて生成された HTML/CSS/Javascript をレスポンスとして返す

ビューはアクションから受け取った users レコードの基づいて HTML/CSS/Javascript を生成し、その結果をクライアント(ブラウザ)に対してレスポンスします。

このような流れで、クライアントはページを閲覧することができます。

## 2. APIモードのRailsアプリ

さて、上記の「1. 通常のRailsアプリ」の仕組みを前提とした上で、今回開発する**APIモード**について説明をしていきます。

**APIモード**とは、MVCアーキテクチャからV(View)をなくして**JSON APIとしての役割に徹する**という設計方針です。

そもそもRailsは「バックエンドもフロントエンドも全部お任せ」が謳い文句なWebアプリケーションフレームワークなのですが、Rubyという言語の性質上バックエンド領域の方が得意であり、**フロントエンド側はあまり得意ではありません**。

フロントエンド領域は言語としては**Javascript**が一強の世界で、ブラウザ上で動的な表現を行うとする場合は基本的に Javascript が必須になります。実際、「1. 通常のRailsアプリ」においても、**jQuery**のような Javascript ライブラリをRails内に導入することでフロントエンド領域をカバーしています。

そうなると、**Railsは自身が得意なバックエンド領域のみに特化してもらい、フロントエンド領域には別のJavascriptフレームワークを持ってこよう** 、という発想に自然に至ります。実際、企業が運営しているRailsアプリケーションのうち、（部分的あるいは全面的に）フロントエンド領域に Javascript フレームワークを採用している例は多く存在します。

そして、Railsにバックエンド領域のみに特化してもらう際の開発モードが**APIモード**です。「1. 通常のRailsアプリ」では、クライアントが受け取るレスポンスはViewによって生成されたHTML/CSS/Javascriptでしたが、「2. APIモードのRailsアプリ」の場合は、レスポンスは**JSON形式のデータ**になります。

JSON形式というのは、Javascriptで取り扱いやすい連想配列型のデータ形式のことです。例えば、`id:1 の user` を取得するリクエストを送信した場合、レスポンスとしては以下のようなJSONデータが想定されます。

```json:
 {
   "id": 1,
   "email": "test@example.com",
   "name": "テスト太郎",
 }
```

このレスポンスJSONをフロントエンド側のフレームワークで適切に利用し、ブラウザ上に画面を表示する流れになります。

## アプリ構成

さて、今回はRails(APIモード)と、Javascriptフレームワークのひとつである**Next.js**を組み合わせ、以下のような構成のアプリケーションを実装していきます。

![](https://storage.googleapis.com/zenn-user-upload/a131a7a006d0-20230825.png)

#### ① Next.js の /users にアクセスする

クラウアント（ブラウザ）は、まずフロントエンド側にあるNext.jsに対して、「ユーザ一覧ページにアクセスしたいです」というリクエストを送ります。

#### ② Rails の /users にリクエストする

クライアントからのリクエストを受け取った Next.js は、該当ページを描画する前に、さらに Rails に対して「ページに描画に必要になる users レコードをください」というリクエストします。

#### ③〜⑦

ここの流れについては、「1. 通常のRailsアプリ」と同様です。

#### ⑧ users レコードをJSON形式に変換して Next.js に渡す

「1. 通常のRailsアプリ」では画面描画に使用する HTML/CSS/Javascript を返していましたが、今回はRailsがAPIモードであるので、JSON形式のデータのみを Next.js に返します。

図で見るとわかる通り、**APIモードのRailsにおいては、MVCアーキテクチャーのうちの V(View) に該当する部分が不要になります**。

#### ⑨ Railsから受け取った JSON形式の users レコードに基づいて画面を描画し、クライアント（ブラウザ）に渡す

こういった流れによって Next.js は晴れて users レコードを取得することができたので、これを使用して画面を描画し、クライアント（ブラウザ）に渡します。

以上のような流れによって、「フロントエンドにNext.js」「バックエンドにRailsAPI」という構成のアプリケーションを実現することができます。
